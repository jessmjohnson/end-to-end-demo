{
	"name": "Telemetry-DMV_Snapshot",
	"properties": {
		"content": {
			"query": "DROP TABLE Telemetry.DMV_Snapshot;\nGO\n-- Table\nCREATE TABLE Telemetry.DMV_Snapshot\n(\n  CaptureTime   DATETIME2(7)     NOT NULL,\n  PipelineRunId UNIQUEIDENTIFIER NOT NULL,\n  PipelineName  VARCHAR(100)     NOT NULL,\n  NodeID        INT              NOT NULL,\n  FileID        SMALLINT         NOT NULL,\n  TotalPageCount               BIGINT NULL,\n  AllocatedExtentPageCount     BIGINT NULL,\n  UnallocatedExtentPageCount   BIGINT NULL\n)\nWITH (DISTRIBUTION = REPLICATE);\nGO\n--CREATE CLUSTERED COLUMNSTORE INDEX CCI_DMV_Snapshot\n--  ON Telemetry.DMV_Snapshot;\n--GO\nALTER TABLE Telemetry.DMV_Snapshot\n  ADD CONSTRAINT PK_DMV_Snapshot\n    PRIMARY KEY NONCLUSTERED (CaptureTime) NOT ENFORCED;\nGO\n\nDROP PROC Telemetry.usp_CaptureDMV\n-- Proc\nCREATE PROC Telemetry.usp_CaptureDMV\n  @PipelineRunId UNIQUEIDENTIFIER,\n  @PipelineName  VARCHAR(100),\n  @CaptureTime   DATETIME2(7)\nAS\nBEGIN\n  SET NOCOUNT ON;\n  INSERT INTO Telemetry.DMV_Snapshot\n    (CaptureTime, PipelineRunId, PipelineName, NodeID, FileID,\n     TotalPageCount, AllocatedExtentPageCount, UnallocatedExtentPageCount)\n  SELECT\n    @CaptureTime,\n    @PipelineRunId,\n    @PipelineName,\n    pdw_node_id,\n    file_id,\n    total_page_count,\n    allocated_extent_page_count,\n    unallocated_extent_page_count\n  FROM sys.dm_pdw_nodes_db_file_space_usage;\nEND;\nGO\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "dspendtoenddemo",
				"poolName": "dspendtoenddemo"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}