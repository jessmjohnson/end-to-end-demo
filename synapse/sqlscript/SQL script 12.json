{
	"name": "SQL script 12",
	"properties": {
		"content": {
			"query": "DROP PROCEDURE [Silver].[usp_LoadParkObservations]\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROC [Silver].[usp_LoadParkObservations] AS\nBEGIN\n  SET NOCOUNT ON;\n\n  -- 1 a) capture how many rows we're about to truncate\n  DECLARE @RowsDeleted INT = (SELECT COUNT(*) FROM Silver.ParkObservations);\n\n  -- 1 b) capture start time\n  DECLARE @StartTime    DATETIME2 = GETDATE();\n\n  -- 2) Clear out old rows\n  TRUNCATE TABLE Silver.ParkObservations;\n\n  -- 3) Insert typed data from Bronze\n  INSERT INTO Silver.ParkObservations\n      (AreaName, AreaID, ParkName, ParkID, ObservationDate, ObservationStartTime, ObservationEndTime,\n       TotalTime, ParkConditions, OtherAnimalSightings, Litter, TemperatureWeather,\n       NumberSquirrels, SquirrelSighters, NumberSighters)\n  SELECT\n    COALESCE(TRY_CONVERT(VARCHAR(50), AreaName), 'Unknown') AS AreaName,\n    COALESCE(TRY_CONVERT(CHAR(1), AreaID), '-1') AS AreaID,\n    COALESCE(TRY_CONVERT(VARCHAR(50), ParkName), 'Unknown') AS ParkName,\n    COALESCE(TRY_CONVERT(DECIMAL, ParkID), -1) AS ParkID,\n    COALESCE(TRY_CONVERT(DATE, [Date], 23),'1900-01-01') AS ObservationDate,\n    COALESCE(TRY_CONVERT(TIME(0), StartTime, 108), CAST('00:00:00' AS TIME(0))) AS ObservationStartTime,\n    COALESCE(TRY_CONVERT(TIME(0), EndTime, 108), CAST('00:00:00' AS TIME(0))) AS ObservationEndTime,\n    COALESCE(TRY_CONVERT(INT, TotalTime), -1) AS TotalTime,\n    COALESCE(TRY_CONVERT(VARCHAR(100), ParkConditions), 'Unknown') AS ParkConditions,\n    COALESCE(TRY_CONVERT(VARCHAR(100), OtherAnimalSightings), 'Unknown') AS OtherAnimalSightings,\n    COALESCE(TRY_CONVERT(VARCHAR(100), Litter), 'Unknown') AS Litter,\n    COALESCE(TRY_CONVERT(VARCHAR(50), TemperatureWeather), 'Unknown') AS TemperatureWeather,\n    COALESCE(TRY_CONVERT(INT, NumberSquirrels), -1) AS NumberSquirrels,\n    COALESCE(TRY_CONVERT(VARCHAR(100), SquirrelSighters), 'Unknown') AS SquirrelSighters,\n    COALESCE(TRY_CONVERT(INT, NumberSighters), -1) AS   NumberSighters\nFROM Bronze.ParkData;\n\n  -- 4 a) How many we just loaded\n  DECLARE @RowsInserted INT = (SELECT COUNT(*) FROM Silver.ParkObservations);\n\n  -- 4 b) compute duration in seconds\n  DECLARE @EndTime      DATETIME2 = GETDATE();\n  DECLARE @DurationSec  INT       = DATEDIFF(SECOND, @StartTime, @EndTime);\n\n  -- 5) return both in a single row\n  SELECT \n    @RowsDeleted  AS RowsDeleted,\n    @RowsInserted AS RowsInserted,\n    @DurationSec  AS DurationSeconds;\n\nEND;\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "dspendtoenddemo",
				"poolName": "dspendtoenddemo"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}